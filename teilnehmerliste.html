<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Teilnehmerliste Open 2026</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      cursor: pointer;
      background: #f0f0f0;
    }
  </style>
</head>
<body>

<h2>Teilnehmerliste Open 2026</h2>
<table id="teilnehmer">
  <thead>
    <tr>
      <th onclick="sortTable(0)">Nr.</th>
      <th onclick="sortTable(1)">Name</th>
      <th onclick="sortTable(2)">Verein</th>
      <th onclick="sortTable(3)">DWZ</th>
      <th onclick="sortTable(4)">Spielberechtigt</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSYCCsqPZWN5u87iWShyg03uFpvzlSQ4jHXOX2DYKS2l8Y86yPjfNMyPJAjYwytKZULf7QS39DHE6_u/pub?gid=0&single=true&output=csv";

fetch(sheetUrl)
  .then(response => response.text())
  .then(csv => {
    const data = Papa.parse(csv, { header: true }).data;
    const tbody = document.querySelector("#teilnehmer tbody");

    const teilnehmer = data.filter(r => r["Nachname"] && r["Vorname"]);

    teilnehmer.sort((a, b) => {
      return parseInt(b["DWZ"]) - parseInt(a["DWZ"]);
    });

    teilnehmer.forEach((row, index) => {
      const tr = document.createElement("tr");

      const name = `${row["Nachname"]}, ${row["Vorname"]}`;
      const verein = row["Schachverein"] || "";
      const dwz = row["DWZ"] || "";
      const sb = row["spielberechtigt"]?.toLowerCase() === "ja" ? "ja" : "";

      tr.innerHTML = `
        <td>${index + 1}</td>
        <td>${name}</td>
        <td>${verein}</td>
        <td>${dwz}</td>
        <td>${sb}</td>
      `;

      tbody.appendChild(tr);
    });
  });

// Sortierfunktion (einfacher Tabellen-Sortiercode)
function sortTable(n) {
  const table = document.getElementById("teilnehmer");
  let switching = true;
  let dir = "desc";
  let switchcount = 0;

  while (switching) {
    switching = false;
    let rows = table.rows;
    for (let i = 1; i < rows.length - 1; i++) {
      let shouldSwitch = false;
      const x = rows[i].getElementsByTagName("TD")[n];
      const y = rows[i + 1].getElementsByTagName("TD")[n];

      let xVal = x.innerText.toLowerCase();
      let yVal = y.innerText.toLowerCase();

      if (!isNaN(parseFloat(xVal)) && !isNaN(parseFloat(yVal))) {
        xVal = parseFloat(xVal);
        yVal = parseFloat(yVal);
      }

      if ((dir === "asc" && xVal > yVal) || (dir === "desc" && xVal < yVal)) {
        shouldSwitch = true;
        break;
      }
    }

    if (shouldSwitch) {
      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
      switching = true;
      switchcount++;
    } else {
      if (switchcount === 0 && dir === "desc") {
        dir = "asc";
        switching = true;
      }
    }
  }
}
</script>

</body>
</html>
